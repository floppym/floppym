From 8e18e8c6d4865206cea4bb1d9b8a36b4e272b30e Mon Sep 17 00:00:00 2001
From: Mike Gilbert <floppymaster@gmail.com>
Date: Fri, 22 Jul 2011 21:42:00 -0400
Subject: [PATCH] Fix compilation against libavcodec major version 53

FF_MM_* macros have been dropped.
---
 channels/drdynvc/tsmf/ffmpeg/tsmf_ffmpeg.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/channels/drdynvc/tsmf/ffmpeg/tsmf_ffmpeg.c b/channels/drdynvc/tsmf/ffmpeg/tsmf_ffmpeg.c
index a85dfc9..3c2b962 100644
--- a/channels/drdynvc/tsmf/ffmpeg/tsmf_ffmpeg.c
+++ b/channels/drdynvc/tsmf/ffmpeg/tsmf_ffmpeg.c
@@ -90,10 +90,12 @@ tsmf_ffmpeg_init_audio_stream(ITSMFDecoder * decoder, const TS_AM_MEDIA_TYPE * m
 
 	/* FFmpeg's float_to_int16_interleave_sse2 would crash at least in WMA decoder.
 	   We disable sse2 to workaround it, however this should be further investigated. */
-#if LIBAVCODEC_VERSION_MAJOR < 52 || (LIBAVCODEC_VERSION_MAJOR == 52 && LIBAVCODEC_VERSION_MINOR <= 20)
+#if LIBAVCODEC_VERSION_INT < AV_VERSION_INT(52, 24, 0)
 	mdecoder->codec_context->dsp_mask = FF_MM_SSE2 | FF_MM_MMXEXT;
-#else
+#elif LIBAVCODEC_VERSION_INT < AV_VERSION_INT(52, 87, 1)
 	mdecoder->codec_context->dsp_mask = FF_MM_SSE2 | FF_MM_MMX2;
+#else
+	mdecoder->codec_context->dsp_mask = AV_CPU_FLAG_SSE2 | AV_CPU_FLAG_MMX2;
 #endif
 
 	return 0;
-- 
1.7.3.4

